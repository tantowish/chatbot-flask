<!-- query.html -->
<html> 
<head> 
	<title>ChatBOT</title> 
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
	<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.0/dist/js.cookie.min.js"></script> 
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script> 
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"> 
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css" integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e" crossorigin="anonymous"> 
	<script> 
		$(document).ready(function() { 
			$('#prompt').keypress(function(event) { 
				if (event.keyCode === 13 && !event.shiftKey) { 
					event.preventDefault(); 
					$('form').submit(); 
				} 
			}); 
			$('form').on('submit', function(event) { 
				event.preventDefault(); 
				var csrftoken = Cookies.get('csrftoken'); 
				
				$.ajaxSetup({ 
					headers: { 'X-CSRFToken': csrftoken } 
				}); 
				// Get the prompt
				var prompt = $('#prompt').val();

				// Replace \n with HTML line breaks in the prompt
				var formattedPrompt = prompt.replace(/\n/g, '<br>');

				var dateTime = new Date();
				var time = dateTime.toLocaleTimeString();

				// User response
				$('#response').append('<p id="GFG1">('+ time + ') <i class="bi bi-person"></i>: ' + formattedPrompt + '</p>');
				$('#response #GFG1').css({"color": "green", "width": "90%", "float": "left"});
				// Clear the prompt 
				$('#prompt').val(''); 
				// Bot Response
				$.ajax({ 
					url: '/', 
					type: 'POST', 
					data: {prompt: prompt}, 
					dataType: 'json', 
					success: function(data) {
						// Replace \n with HTML line breaks
						var formattedResponse = data.response.replace(/\n/g, '<br>');

						$('#response').append('<p id="GFG2">('+ time + ') <i class="bi bi-robot"></i>: ' + formattedResponse + '</p>');
						$('#response #GFG2').css({"color": "red", "width": "90%", "float": "left"});
					}
				}); 
			}); 
		}); 
	</script> 
</head> 
<body> 
	<div class="container p-3"> 
		<h3>Carigi Chatbot</h3> 
		<div class="mb-3"> 
			<form method="post" action=""> 
				<label for="prompt" class="form-label"><strong>Prompt: </strong></label> 
				<textarea class="form-control" type="textarea" id="prompt" name="prompt" rows="3"></textarea> 
				<br> 
				<button class="btn btn-primary " type="submit">Submit</button> 
			</form> 
		</div> 
		<br> 
		<div class="mb-3"> 
			<h6>Response:</h6> 
			<div class="container border overflow-auto h-50" id="response">
				<p id="GFG2" style="color:red;width:90%;float:left">({{ time }}) <i class="bi bi-robot"></i>{{ introduction }}</p>
			</div> 
			
		</div> 
	</div> 
</body> 
</html> 



